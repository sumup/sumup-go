// Code generated by `go-sdk-gen`. DO NOT EDIT.

package sumup

import (
	"bytes"
	"compress/gzip"
	"context"
	"encoding/base64"
	"encoding/json"
	"encoding/xml"
	"errors"
	"fmt"
	"io"
	"net/http"
	"net/url"
	"os"
	"path"
	"strings"
	"time"

	"gopkg.in/yaml.v2"

	"github.com/sumup/sumup-go/client"
	"github.com/sumup/sumup-go/datetime"
	"github.com/sumup/sumup-go/internal/ptr"
	"github.com/sumup/sumup-go/secret"
)

{{- range $type := .Types }}
{{ $type.String }}
{{- end }}

{{ if ne (len .Methods) 0 }}
type {{.Service}}Client struct {
	c *client.Client
}

func New{{.Service}}Client(c *client.Client) *{{.Service}}Client {
	return &{{.Service}}Client{c: c}
}

{{ range $method := .Methods }}
{{ $responseType := .ResponseType}}
{{- with .Description}}
// {{.}}
{{- end }}
func (c *{{$.Service}}Client) {{.FunctionName}}({{.ParamsString}}) {{with .ResponseType}}(*{{.Type}}, error){{else}}error{{end}} {
	path := {{.Path}}

    resp, err := c.c.Call(ctx, {{.HTTPMethod}}, path
	{{- if .HasBody }}, client.WithJSONBody(body){{ end -}}
	{{- if .QueryParams }}, client.WithQueryValues(params.QueryValues()){{ end -}}
	)
	if err != nil {
		return {{with $responseType}}nil, {{end}}fmt.Errorf("error building request: %v", err)
	}
    defer resp.Body.Close()

	switch resp.StatusCode {
	{{- range $resp := .Responses }}
	{{- if $resp.IsDefault }}
	default:
	{{- else }}
	case {{ $resp.Code | httpStatusCode }}:
	{{- end }}
		{{- if $resp.IsErr }}
		{{- with .Type }}
		var apiErr {{ $resp.Type }}
		if err := json.NewDecoder(resp.Body).Decode(&apiErr); err != nil {
			return {{with $responseType}}nil, {{end}}fmt.Errorf("read error response: %s", err.Error())
		}

		return {{with $responseType}}nil, {{end}}&apiErr
		{{- else}}
		return {{with $responseType}}nil, {{end}}errors.New("{{ $resp.ErrDescription }}")
	    {{- end}}
		{{- else if $resp.IsUnexpected }}
		return {{with $responseType}}nil, {{end}}fmt.Errorf("unexpected response %d: %s", resp.StatusCode, http.StatusText(resp.StatusCode))
		{{- else }}
		{{- with .Type }}
	    var v {{.}}
		if err := json.NewDecoder(resp.Body).Decode(&v); err != nil {
			return nil, fmt.Errorf("decode response: %s", err.Error())
		}

		{{ if $responseType.IsOneOf }}
		return &{{ $responseType.Type }}{
			{{.}}: &v,
		}, nil
		{{- else }}
		return &v, nil
		{{- end }}
		{{- else}}
		return {{with $responseType}}nil, {{end}}nil
	    {{- end}}
		{{- end }}
	{{- end }}
	}
}
{{ end }}
{{ end }}
